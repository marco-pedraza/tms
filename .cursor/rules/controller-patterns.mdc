---
description: Patterns for controllers in Encore applications
globs: *.controller.ts
alwaysApply: false
---

# Controller Patterns

> **ðŸ“– See `AGENTS.md` for complete API patterns and detailed examples**

## Essential Description

Controllers define API endpoints using Encore's `api()`. They delegate validation to domain and operations to repositories/application services. Middleware handles errors automatically (no try/catch). **Entity Pattern**: delegate to application service. **Repository Pattern**: validate and call repository directly.

## Practical Examples

### Repository Pattern

```typescript
import { api } from 'encore.dev/api';
import { validateFeature } from './feature.domain';
import { featureRepository } from './feature.repository';

export const createFeature = api(
  { method: 'POST', path: '/features/create', auth: true },
  async (params: CreatePayload): Promise<Feature> => {
    await validateFeature(params);
    return await featureRepository.create(params);
  }
);

export const getFeature = api(
  { method: 'GET', path: '/features/:id', auth: true },
  async ({ id }: { id: number }): Promise<Feature> => {
    return await featureRepository.findOne(id);
  }
);

export const listFeatures = api(
  { method: 'POST', path: '/features/list/all', auth: true },
  async (params: ListQueryParams): Promise<ListResult> => {
    const data = await featureRepository.findAll(params);
    return { data };
  }
);

export const updateFeature = api(
  { method: 'PUT', path: '/features/:id/update', auth: true },
  async ({ id, ...data }: UpdatePayload & { id: number }): Promise<Feature> => {
    await validateFeature(data, id);
    return await featureRepository.update(id, data);
  }
);

export const deleteFeature = api(
  { method: 'DELETE', path: '/features/:id/delete', auth: true },
  async ({ id }: { id: number }): Promise<Feature> => {
    return await featureRepository.delete(id);
  }
);
```

### Entity Pattern

```typescript
import { api } from 'encore.dev/api';
import { featureApplicationService } from './feature.application-service';

export const createFeature = api(
  { method: 'POST', path: '/features/create', auth: true },
  async (params: CreatePayload): Promise<Feature> => {
    return await featureApplicationService.createFeature(params);
  }
);

export const updateFeature = api(
  { method: 'PUT', path: '/features/:id/update', auth: true },
  async ({ id, ...data }: UpdatePayload & { id: number }): Promise<Feature> => {
    return await featureApplicationService.updateFeature(id, data);
  }
);
```

## Endpoint Conventions

- `POST /resources/create` - Create
- `GET /resources/:id` - Get one
- `POST /resources/list/all` - List all (non-paginated)
- `POST /resources/list` - List paginated
- `PUT /resources/:id/update` - Update
- `DELETE /resources/:id/delete` - Delete

## References

- See `AGENTS.md` section "API Patterns (Encore)" for complete conventions
- See `AGENTS.md` section "Error Handling" for error handling
